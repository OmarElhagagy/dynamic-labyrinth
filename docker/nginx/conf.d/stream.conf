# =============================================================================
# Dynamic Labyrinth - Nginx Stream Configuration
# =============================================================================
# TCP/UDP stream proxying for non-HTTP honeytrap services
# =============================================================================

# -----------------------------------------------------------------------------
# SSH Proxy (Port 2222 -> Honeytrap SSH)
# -----------------------------------------------------------------------------
server {
    listen 2222;
    
    proxy_pass level1_ssh;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level1_ssh {
    least_conn;
    server honeytrap-level1-1:22 weight=1;
    server honeytrap-level1-2:22 weight=1;
    server honeytrap-level1-3:22 weight=1;
    server honeytrap-level1-4:22 weight=1;
    server honeytrap-level1-5:22 weight=1;
}

# -----------------------------------------------------------------------------
# Telnet Proxy (Port 2323 -> Honeytrap Telnet)
# -----------------------------------------------------------------------------
server {
    listen 2323;
    
    proxy_pass level1_telnet;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level1_telnet {
    least_conn;
    server honeytrap-level1-1:23 weight=1;
    server honeytrap-level1-2:23 weight=1;
    server honeytrap-level1-3:23 weight=1;
    server honeytrap-level1-4:23 weight=1;
    server honeytrap-level1-5:23 weight=1;
}

# -----------------------------------------------------------------------------
# FTP Proxy (Port 2121 -> Level 2 Honeytrap FTP)
# -----------------------------------------------------------------------------
server {
    listen 2121;
    
    proxy_pass level2_ftp;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level2_ftp {
    least_conn;
    server honeytrap-level2-1:21 weight=1;
    server honeytrap-level2-2:21 weight=1;
    server honeytrap-level2-3:21 weight=1;
}

# -----------------------------------------------------------------------------
# SMTP Proxy (Port 2525 -> Level 2 Honeytrap SMTP)
# -----------------------------------------------------------------------------
server {
    listen 2525;
    
    proxy_pass level2_smtp;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level2_smtp {
    least_conn;
    server honeytrap-level2-1:25 weight=1;
    server honeytrap-level2-2:25 weight=1;
    server honeytrap-level2-3:25 weight=1;
}

# -----------------------------------------------------------------------------
# DNS Proxy (UDP Port 5353 -> Level 2 Honeytrap DNS)
# -----------------------------------------------------------------------------
server {
    listen 5353 udp;
    
    proxy_pass level2_dns;
    proxy_timeout 10s;
}

upstream level2_dns {
    server honeytrap-level2-1:53 weight=1;
    server honeytrap-level2-2:53 weight=1;
    server honeytrap-level2-3:53 weight=1;
}

# -----------------------------------------------------------------------------
# VNC Proxy (Port 5901 -> Level 3 Honeytrap VNC)
# -----------------------------------------------------------------------------
server {
    listen 5901;
    
    proxy_pass level3_vnc;
    proxy_connect_timeout 10s;
    proxy_timeout 600s;  # Longer timeout for VNC sessions
}

upstream level3_vnc {
    server honeytrap-level3-1:5900 weight=1;
}

# -----------------------------------------------------------------------------
# Redis Proxy (Port 6380 -> Level 3 Honeytrap Redis)
# -----------------------------------------------------------------------------
server {
    listen 6380;
    
    proxy_pass level3_redis;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level3_redis {
    server honeytrap-level3-1:6379 weight=1;
}

# -----------------------------------------------------------------------------
# Elasticsearch Proxy (Port 9201 -> Level 3 Honeytrap ES)
# -----------------------------------------------------------------------------
server {
    listen 9201;
    
    proxy_pass level3_elasticsearch;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level3_elasticsearch {
    server honeytrap-level3-1:9200 weight=1;
}

# -----------------------------------------------------------------------------
# Docker API Proxy (Port 2376 -> Level 3 Honeytrap Docker)
# -----------------------------------------------------------------------------
server {
    listen 2376;
    
    proxy_pass level3_docker;
    proxy_connect_timeout 10s;
    proxy_timeout 300s;
}

upstream level3_docker {
    server honeytrap-level3-1:2375 weight=1;
}
