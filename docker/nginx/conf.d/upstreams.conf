# =============================================================================
# Dynamic Labyrinth - Nginx Upstream Definitions
# =============================================================================
# Defines the upstream server pools for each honeytrap level
# =============================================================================

# -----------------------------------------------------------------------------
# Level 1 Pool - Low Interaction (5 containers)
# -----------------------------------------------------------------------------
upstream level1_pool {
    # Load balancing method
    least_conn;
    
    # Keep connections alive
    keepalive 32;
    
    # Container instances
    server honeytrap-level1-1:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level1-2:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level1-3:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level1-4:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level1-5:8080 weight=1 max_fails=3 fail_timeout=30s;
}

# -----------------------------------------------------------------------------
# Level 2 Pool - Medium Interaction (3 containers)
# -----------------------------------------------------------------------------
upstream level2_pool {
    # Use least connections for better distribution
    least_conn;
    
    # Keep connections alive
    keepalive 16;
    
    # Container instances
    server honeytrap-level2-1:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level2-2:8080 weight=1 max_fails=3 fail_timeout=30s;
    server honeytrap-level2-3:8080 weight=1 max_fails=3 fail_timeout=30s;
}

# -----------------------------------------------------------------------------
# Level 3 Pool - High Interaction (1 container)
# -----------------------------------------------------------------------------
upstream level3_pool {
    # Single high-interaction container
    server honeytrap-level3-1:8080 weight=1 max_fails=3 fail_timeout=30s;
    
    # Keep connections alive
    keepalive 8;
}

# -----------------------------------------------------------------------------
# Orchestrator Backend
# -----------------------------------------------------------------------------
upstream orchestrator {
    server orchestrator:8000 max_fails=3 fail_timeout=30s;
    keepalive 8;
}

# -----------------------------------------------------------------------------
# Cerebrum Backend (for internal routing)
# -----------------------------------------------------------------------------
upstream cerebrum {
    server cerebrum:8001 max_fails=3 fail_timeout=30s;
    keepalive 8;
}

# -----------------------------------------------------------------------------
# Dashboard Backend
# -----------------------------------------------------------------------------
upstream dashboard_backend {
    server dashboard-backend:8002 max_fails=3 fail_timeout=30s;
    keepalive 8;
}
