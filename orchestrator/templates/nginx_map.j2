{# =============================================================================
   Dynamic Labyrinth - Nginx Upstream Map Template
   =============================================================================
   This Jinja2 template generates the nginx map file for session-based routing.
   Variables:
     - generated_at: Timestamp of generation
     - default_upstream: Default upstream pool name
     - entries: List of session mappings
         - session_cookie: Cookie value (dlsess_xxxx)
         - session_id: Session identifier
         - upstream: Target container address (ip:port)
   ============================================================================= #}

# =============================================================================
# Dynamic Labyrinth - Honeytrap Upstream Map
# =============================================================================
# Auto-generated by Orchestrator service
# DO NOT EDIT MANUALLY - changes will be overwritten
#
# Generated: {{ generated_at }}
# Total entries: {{ entries | length }}
# =============================================================================

map $cookie_dlsess $honeytrap_upstream {
    # -------------------------------------------------------------------------
    # Default Upstream
    # -------------------------------------------------------------------------
    # Sessions without a specific mapping are routed to the level 1 pool
    default "{{ default_upstream }}";

{% if entries %}
    # -------------------------------------------------------------------------
    # Session Mappings
    # -------------------------------------------------------------------------
{% for entry in entries %}
    # Session: {{ entry.session_id }}
    "{{ entry.session_cookie }}" "{{ entry.upstream }}";
{% endfor %}
{% else %}
    # No active session mappings
{% endif %}
}

# =============================================================================
# Map Statistics (for monitoring)
# =============================================================================
# Active mappings: {{ entries | length }}
# Default target: {{ default_upstream }}
